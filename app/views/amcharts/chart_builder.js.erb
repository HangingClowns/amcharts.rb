// If the container element doesn't already exist, create it
add_container_if_needed('<%= container %>', <%= chart.width %>, <%= chart.height %>);

AmCharts.ready(function() {
  var chart_data = <%= builder.to_js(chart.data) %>;
  var chart = new <%= chart.amchart_type %>;

  chart.dataProvider = chart_data;
  chart.categoryField = '<%= chart.category_field %>';
  chart.pathToImages = '<%= escape_javascript asset_path('amcharts/') %>';

  <% builder.render_settings(chart, 'chart') %>

  <% builder.render_data(chart) %>

  <% builder.render_component(chart.legends, name: :legend, type: 'AmLegend') %>
  <% builder.render_component(chart.category_axis, name: :category_axis, js_object: 'chart.categoryAxis', method: false) %>
  <% builder.render_component(chart.value_axes, name: :value_axis) %>
  <% builder.render_component(chart.cursor, name: :chart_cursor) %>
  <% builder.render_component(chart.scrollbar, name: :chart_scrollbar) %>

  <% builder.render_title(chart) %>

  chart.write('<%= container %>');
});